---
description: Testing patterns for logpare test files
globs: test/**/*.ts
---

# Testing Guidelines

## Test Structure

```typescript
describe('Drain algorithm', () => {
  it('should create new cluster for dissimilar log', () => {
    // Arrange
    const drain = createDrain();

    // Act
    drain.process('ERROR connection timeout');
    drain.process('INFO request completed');

    // Assert
    expect(drain.getClusters().length).toBe(2);
  });
});
```

## Internal Testing

Tests can import internal classes directly:
```typescript
import { LogCluster } from '../src/drain/cluster.js';
import { DrainNode } from '../src/drain/node.js';
```

## Fixture Testing

Use real log files from `test/fixtures/`:
```typescript
import { readFileSync } from 'node:fs';

const logs = readFileSync('test/fixtures/hdfs.log', 'utf-8');
const result = compressText(logs);
expect(result.stats.compressionRatio).toBeGreaterThan(0.6);
```

## Commands

```bash
pnpm test                      # All tests
pnpm test test/drain.test.ts   # Single file
pnpm test -t "should discover" # Pattern match
pnpm bench                     # Benchmarks only
```
