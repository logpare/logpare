---
description: MCP server development patterns for logpare integration
globs: packages/mcp/**/*.ts, mcp/**/*.ts
---

# MCP Server Development

## Server Setup

```typescript
import { Server } from '@modelcontextprotocol/sdk/server/index.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import { compress } from 'logpare';

const server = new Server({
  name: 'logpare-mcp',
  version: '0.1.0',
}, {
  capabilities: { tools: {} },
});
```

## Tool Definitions

```typescript
server.setRequestHandler(ListToolsRequestSchema, async () => ({
  tools: [{
    name: 'compress_logs',
    description: 'Compress logs using Drain algorithm',
    inputSchema: {
      type: 'object',
      properties: {
        logs: { type: 'array', items: { type: 'string' } },
        format: { enum: ['summary', 'detailed', 'json'] },
      },
      required: ['logs'],
    },
  }],
}));
```

## Input Validation

Always validate tool arguments before processing:
```typescript
function validateArgs(args: unknown, required: string[]): Record<string, unknown> {
  if (!args || typeof args !== 'object') {
    throw new Error('Invalid arguments: expected object');
  }
  for (const key of required) {
    if (!(key in args)) {
      throw new Error(`Missing required argument: ${key}`);
    }
  }
  return args as Record<string, unknown>;
}

// Usage in handler
case 'compress_logs': {
  const validated = validateArgs(args, ['logs']);
  if (!Array.isArray(validated.logs)) {
    throw new Error('Invalid logs: expected array of strings');
  }
  // ... process validated input
}
```

## Security: File Path Validation

Prevent directory traversal when handling file paths:
```typescript
import path from 'path';

const filePath = args.filePath as string;
const resolvedPath = path.resolve(filePath);

if (filePath.includes('..') || !resolvedPath.startsWith(process.cwd())) {
  throw new Error('Invalid file path: directory traversal not allowed');
}
```

## Error Handling

Return structured errors with `isError: true`:
```typescript
return {
  content: [{ type: 'text', text: `Error: ${error.message}` }],
  isError: true,
};
```

## Transport

Use stdio for Claude Desktop/Cursor:
```typescript
const transport = new StdioServerTransport();
await server.connect(transport);
```
